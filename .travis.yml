language: python
python:
- '3.6'
env:
  global:
  - TC_HOME=$HOME/tc
  - MBED_BUILD_TIMESTAMP=42
matrix:
  include:
  - os: linux
    env: MBED_CLOUD=1.5.0 ARMGCC_VERSION=6.3.1
  - os: linux
    env: MBED_CLOUD=2.0.1.1 ARMGCC_VERSION=6.3.1
  - os: linux
    env: MBED_CLOUD=2.0.1.1 ARMGCC_VERSION=7.3.1
before_install:
- pip install -U pip wheel
- pip install mbed-cli
- mbed deploy
- "./toolchain_install.sh"
script:
- ". ./mbed-cloud-build.sh && cloudbuild cloud_client ${MBED_CLOUD}"
cache:
  directories:
  - "${TC_HOME}"
  - "${HOME}/.mbed/mbed-cache"
before_deploy:
  - printenv
  - find cloud_client/BUILD/
deploy:
  provider: releases
  skip_cleanup: true
  file_glob: true
  file: cloud_client/BUILD/file1.txt
  api_key: ${GITHUB_TOKEN}
  on:
    all_branches: true
    tags: false
    condition: $TRAVIS_PULL_REQUEST == "false"
